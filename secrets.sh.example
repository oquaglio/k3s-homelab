#!/bin/bash
# secrets.sh.example - Template for creating K8s secrets
# Copy this file to secrets.sh and customize it
# DO NOT commit secrets.sh to git!

set -e

echo "========================================="
echo "Creating K8s Secrets"
echo "========================================="
echo ""

export KUBECONFIG=~/.kube/config

# ========================================
# Define your passwords here
# ========================================
export PORTAINER_PASSWORD="changeme123"  # CHANGE THIS!
export GRAFANA_PASSWORD="admin"  # CHANGE THIS!

# Create namespaces if they don't exist
echo "Ensuring namespaces exist..."
kubectl create namespace portainer --dry-run=client -o yaml | kubectl apply -f -
kubectl create namespace monitoring --dry-run=client -o yaml | kubectl apply -f -
echo ""

# ========================================
# Grafana Admin Password
# ========================================
echo "Setting up Grafana password..."

# Create secret
kubectl create secret generic kube-prometheus-stack-grafana \
  --from-literal=admin-user=admin \
  --from-literal=admin-password="$GRAFANA_PASSWORD" \
  -n monitoring \
  --dry-run=client -o yaml | kubectl apply -f -

echo "âœ“ Grafana password secret created"
echo ""

# ========================================
# Summary
# ========================================
echo "========================================="
echo "Secrets created successfully!"
echo "========================================="
echo ""
echo "Credentials:"
echo "  Portainer:  admin / $PORTAINER_PASSWORD"
echo "  Grafana:    admin / $GRAFANA_PASSWORD"
echo ""
echo "IMPORTANT: Change the passwords in this script before running!"
echo "IMPORTANT: Do not commit secrets.sh to git!"
